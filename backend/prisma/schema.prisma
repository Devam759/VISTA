// Prisma Schema for VISTA

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL") // Format: mysql://user:password@host:port/database
  // For production: mysql://sql12806790:C9E5gce8nV@sql12.freesqldatabase.com:3306/sql12806790
  // For local: mysql://root:111@localhost:3306/vista
}

model Hostel {
  id        Int       @id @default(autoincrement())
  name      String    @db.VarChar(100)
  students  Student[]
  wardens   Warden[]
  rooms     Room[]
  createdAt DateTime  @default(now()) @map("created_at")

  @@map("hostels")
}

model Room {
  id       Int     @id @default(autoincrement())
  roomNo   String  @map("room_no") @db.VarChar(10)
  hostelId Int     @map("hostel_id")
  hostel   Hostel  @relation(fields: [hostelId], references: [id], onDelete: Cascade)
  isAC     Boolean @default(false) @map("is_ac")
  students Student[]

  @@map("rooms")
  @@index([hostelId])
  @@unique([hostelId, roomNo])
}

model Student {
  id         Int          @id @default(autoincrement())
  name       String       @db.VarChar(100)
  rollNo     String       @unique @map("roll_no") @db.VarChar(30)
  roomNo     String       @map("room_no") @db.VarChar(10)
  regNo      String?      @map("reg_no") @db.VarChar(40)
  roomId     Int?         @map("room_id")
  hostelId   Int          @map("hostel_id")
  program    String       @db.VarChar(80)
  mobile     String       @db.VarChar(15)
  address    String       @db.Text
  email      String       @unique @db.VarChar(120)
  password   String       @db.VarChar(255)
  faceIdUrl  String?      @map("face_id_url") @db.Text
  hostel     Hostel       @relation(fields: [hostelId], references: [id], onDelete: Cascade)
  room       Room?        @relation(fields: [roomId], references: [id])
  attendance Attendance[]
  createdAt  DateTime     @default(now()) @map("created_at")

  @@map("students")
  @@index([hostelId])
  @@index([email])
}

model Warden {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(100)
  email     String   @unique @db.VarChar(120)
  password  String   @db.VarChar(255)
  mobile    String   @db.VarChar(15)
  hostelId  Int      @map("hostel_id")
  hostel    Hostel   @relation(fields: [hostelId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")

  @@map("wardens")
  @@index([hostelId])
  @@index([email])
}

model Attendance {
  id           Int                @id @default(autoincrement())
  studentId    Int                @map("student_id")
  date         DateTime           @db.Date
  time         DateTime           @db.Time(0)
  status       AttendanceStatus
  faceVerified Boolean            @default(false) @map("face_verified")
  student      Student            @relation(fields: [studentId], references: [id], onDelete: Cascade)
  createdAt    DateTime           @default(now()) @map("created_at")

  @@unique([studentId, date])
  @@map("attendance")
  @@index([studentId])
  @@index([date])
}

model CampusPolygon {
  id         Int   @id @default(autoincrement())
  lat        Float @db.Double
  lng        Float @db.Double
  pointOrder Int   @map("point_order")

  @@map("campus_polygon")
}

enum AttendanceStatus {
  Marked
  Missed
  Late
}
